<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Autostrada Animation</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        .autostrada {
            position: relative;
            width: 100%;
            height: 300px; 
            background: lightgray;
            margin: 50px 0;
            overflow: hidden;
        }
        .stazione {
            position: absolute;
            width: 40px;
            height: 40px;
            background: red;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 14px;
            cursor: pointer;
            transition: transform 0.3s;
        }
        .auto {
            position: absolute;
            width: 30px;
            height: 30px;
            background: blue;
            border-radius: 50%;
            color: white;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 5px;
            transition: transform 0.3s;
        }
        .path {
            position: absolute;
            width: 5px;
            background: yellow;
            z-index: -1;
            transform-origin: top;
        }
        .selected {
            background: green !important;
        }
        .visited {
            background: orange !important;
        }
    </style>
</head>
<body>
    <h1>Autostrada Animation</h1>
    <div class="autostrada" id="autostrada"></div>
    <div>
        <button onclick="planRoute()">Pianifica Percorso</button>
    </div>
    <script>
        const stazioniData = [
            { distanza: 10, veicoli: [30, 25, 20, 15] },
            { distanza: 20, veicoli: [35, 30, 25, 20, 15] },
            { distanza: 30, veicoli: [35, 30, 25] },
            { distanza: 40, veicoli: [35, 30, 25, 20, 15, 10] },
            { distanza: 50, veicoli: [35, 30, 25, 20, 15, 10, 5] },
            { distanza: 60, veicoli: [35, 30, 25, 20, 15, 10, 5, 0] },
            { distanza: 70, veicoli: [35, 30, 25, 20, 15, 10, 5, 0] },
            { distanza: 80, veicoli: [35, 30, 25, 20, 15, 10, 5, 0] },
            { distanza: 90, veicoli: [35, 30] },
            { distanza: 100, veicoli: [35] }
        ];

        let selectedStazioni = [];
        let previousPath = [];

        function createStazione(stazione, index) {
            const autostrada = document.getElementById('autostrada');
            const stazioneDiv = document.createElement('div');
            stazioneDiv.className = 'stazione';
            stazioneDiv.style.left = `${stazione.distanza * 5}px`;
            stazioneDiv.dataset.index = index;
            stazioneDiv.dataset.distanza = stazione.distanza;
            stazioneDiv.innerText = stazione.distanza;

            stazioneDiv.addEventListener('click', () => {
                if (selectedStazioni.length < 2) {
                    stazioneDiv.classList.toggle('selected');
                    if (stazioneDiv.classList.contains('selected')) {
                        selectedStazioni.push(index);
                    } else {
                        selectedStazioni = selectedStazioni.filter(i => i !== index);
                    }
                }
            });

            autostrada.appendChild(stazioneDiv);

            const maxAutonomia = Math.max(...stazione.veicoli);
            const autoDiv = document.createElement('div');
            autoDiv.className = 'auto';
            autoDiv.style.left = `${stazione.distanza * 5}px`;
            autoDiv.style.top = '60px';
            autoDiv.innerText = maxAutonomia;

            autostrada.appendChild(autoDiv);
        }

        function addStazioni() {
            stazioniData.forEach((stazione, index) => {
                createStazione(stazione, index);
            });
        }

        function clearPreviousPath() {
            previousPath.forEach(index => {
                document.querySelector(`[data-index="${index}"]`).classList.remove('visited');
            });
            previousPath = [];
        }

        function pianificaPercorso(stazioni, start, end) {
            const numStazioni = stazioni.length;
            const distanze = new Array(numStazioni).fill(Infinity);
            const predecessori = new Array(numStazioni).fill(-1);
            const visitate = new Array(numStazioni).fill(false);

            distanze[start] = 0;

            for (let i = 0; i < numStazioni - 1; i++) {
                let minDistanza = Infinity;
                let minIndex = -1;

                for (let j = 0; j < numStazioni; j++) {
                    if (!visitate[j] && distanze[j] <= minDistanza) {
                        minDistanza = distanze[j];
                        minIndex = j;
                    }
                }

                if (minIndex === -1) break;

                visitate[minIndex] = true;

                for (let j = 0; j < numStazioni; j++) {
                    const maxAutonomia = Math.max(...stazioni[minIndex].veicoli);
                    const distanzaAttuale = stazioni[minIndex].distanza;
                    const distanzaSuccessiva = stazioni[j].distanza;
                    if (!visitate[j] && distanzaSuccessiva <= distanzaAttuale + maxAutonomia) {
                        if (distanze[minIndex] + 1 < distanze[j]) {
                            distanze[j] = distanze[minIndex] + 1;
                            predecessori[j] = minIndex;
                        }
                    }
                }
            }

            let percorso = [];
            for (let at = end; at !== -1; at = predecessori[at]) {
                percorso.push(at);
            }
            percorso.reverse();

            return percorso;
        }

        function planRoute() {
            if (selectedStazioni.length === 2) {
                clearPreviousPath();
                
                const [startIndex, endIndex] = selectedStazioni.sort((a, b) => a - b);

                const percorso = pianificaPercorso(stazioniData, startIndex, endIndex);

                if (percorso.length === 1 && percorso[0] === startIndex) {
                    alert("Nessun percorso disponibile");
                    return;
                }

                percorso.forEach(index => {
                    document.querySelector(`[data-index="${index}"]`).classList.add('visited');
                    previousPath.push(index);
                });

                const startStazione = document.querySelector(`[data-index="${startIndex}"]`);
                const endStazione = document.querySelector(`[data-index="${endIndex}"]`);
                
                const startX = parseInt(startStazione.style.left);
                const endX = parseInt(endStazione.style.left);
                
                const pathDiv = document.createElement('div');
                pathDiv.className = 'path';
                pathDiv.style.left = `${startX + 20}px`;
                pathDiv.style.top = '20px';
                pathDiv.style.height = '5px';
                pathDiv.style.width = `${endX - startX}px`;
                
                const autostrada = document.getElementById('autostrada');
                autostrada.appendChild(pathDiv);

                selectedStazioni = [];
                document.querySelectorAll('.stazione').forEach(stazione => stazione.classList.remove('selected'));
            }
        }

        addStazioni();
    </script>
</body>
</html>
